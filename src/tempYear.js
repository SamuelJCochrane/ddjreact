//import { tempTimetable } from './tempTimetable.js';
const tempTimetable = {
    monday: [
      {'00:00': []},
      {'01:00': []},
      {'02:00': []},
      {'03:00': []},
      {'04:00': []},
      {'05:00': []},
      {'06:00': []},
      {'07:00': []},
      {'08:00': []},
      {'09:00': []},
      {'10:00': []},
      {'11:00': []},
      {'12:00': []},
      {'13:00': []},
      {'14:00': []},
      {'15:00': []},
      {'16:00': []},
      {'17:00': []},
      {'18:00': []},
      {'19:00': []},
      {'20:00': []},
      {'21:00': []},
      {'22:00': []},
      {'23:00': []},
    ],
    tuesday: [
      {'00:00': []},
      {'01:00': []},
      {'02:00': []},
      {'03:00': []},
      {'04:00': []},
      {'05:00': []},
      {'06:00': []},
      {'07:00': []},
      {'08:00': []},
      {'09:00': []},
      {'10:00': []},
      {'11:00': []},
      {'12:00': []},
      {'13:00': []},
      {'14:00': []},
      {'15:00': []},
      {'16:00': []},
      {'17:00': []},
      {'18:00': []},
      {'19:00': []},
      {'20:00': []},
      {'21:00': []},
      {'22:00': []},
      {'23:00': []},
    ],
    wednesday: [
      {'00:00': []},
      {'01:00': []},
      {'02:00': []},
      {'03:00': []},
      {'04:00': []},
      {'05:00': []},
      {'06:00': []},
      {'07:00': []},
      {'08:00': []},
      {'09:00': []},
      {'10:00': []},
      {'11:00': []},
      {'12:00': []},
      {'13:00': []},
      {'14:00': []},
      {'15:00': []},
      {'16:00': []},
      {'17:00': []},
      {'18:00': []},
      {'19:00': []},
      {'20:00': []},
      {'21:00': []},
      {'22:00': []},
      {'23:00': []},
    ],
    thursday: [
      {'00:00': []},
      {'01:00': []},
      {'02:00': []},
      {'03:00': []},
      {'04:00': []},
      {'05:00': []},
      {'06:00': []},
      {'07:00': []},
      {'08:00': []},
      {'09:00': []},
      {'10:00': []},
      {'11:00': []},
      {'12:00': []},
      {'13:00': []},
      {'14:00': []},
      {'15:00': []},
      {'16:00': []},
      {'17:00': []},
      {'18:00': []},
      {'19:00': []},
      {'20:00': []},
      {'21:00': []},
      {'22:00': []},
      {'23:00': []},
    ],
    friday: [
      {'00:00': []},
      {'01:00': []},
      {'02:00': []},
      {'03:00': []},
      {'04:00': []},
      {'05:00': []},
      {'06:00': []},
      {'07:00': []},
      {'08:00': []},
      {'09:00': []},
      {'10:00': []},
      {'11:00': []},
      {'12:00': []},
      {'13:00': []},
      {'14:00': []},
      {'15:00': []},
      {'16:00': []},
      {'17:00': []},
      {'18:00': []},
      {'19:00': []},
      {'20:00': []},
      {'21:00': []},
      {'22:00': []},
      {'23:00': []},
    ],
    saturday: [
      {'00:00': []},
      {'01:00': []},
      {'02:00': []},
      {'03:00': []},
      {'04:00': []},
      {'05:00': []},
      {'06:00': []},
      {'07:00': []},
      {'08:00': []},
      {'09:00': []},
      {'10:00': []},
      {'11:00': []},
      {'12:00': []},
      {'13:00': []},
      {'14:00': []},
      {'15:00': []},
      {'16:00': []},
      {'17:00': []},
      {'18:00': []},
      {'19:00': []},
      {'20:00': []},
      {'21:00': []},
      {'22:00': []},
      {'23:00': []},
    ],
    sunday: [
      {'00:00': []},
      {'01:00': []},
      {'02:00': []},
      {'03:00': []},
      {'04:00': []},
      {'05:00': []},
      {'06:00': []},
      {'07:00': []},
      {'08:00': []},
      {'09:00': []},
      {'10:00': []},
      {'11:00': []},
      {'12:00': []},
      {'13:00': []},
      {'14:00': []},
      {'15:00': []},
      {'16:00': []},
      {'17:00': []},
      {'18:00': []},
      {'19:00': []},
      {'20:00': []},
      {'21:00': []},
      {'22:00': []},
      {'23:00': []},
    ],
  }

const daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
export class Timetable {
    constructor() {
      this.monday = [
        {'00:00': []},
        {'01:00': []},
        {'02:00': []},
        {'03:00': []},
        {'04:00': []},
        {'05:00': []},
        {'06:00': []},
        {'07:00': []},
        {'08:00': []},
        {'09:00': []},
        {'10:00': []},
        {'11:00': []},
        {'12:00': []},
        {'13:00': []},
        {'14:00': []},
        {'15:00': []},
        {'16:00': []},
        {'17:00': []},
        {'18:00': []},
        {'19:00': []},
        {'20:00': []},
        {'21:00': []},
        {'22:00': []},
        {'23:00': []},
      ];
      this.tuesday = [
        {'00:00': []},
        {'01:00': []},
        {'02:00': []},
        {'03:00': []},
        {'04:00': []},
        {'05:00': []},
        {'06:00': []},
        {'07:00': []},
        {'08:00': []},
        {'09:00': []},
        {'10:00': []},
        {'11:00': []},
        {'12:00': []},
        {'13:00': []},
        {'14:00': []},
        {'15:00': []},
        {'16:00': []},
        {'17:00': []},
        {'18:00': []},
        {'19:00': []},
        {'20:00': []},
        {'21:00': []},
        {'22:00': []},
        {'23:00': []},
      ];
      this.wednesday = [
        {'00:00': []},
        {'01:00': []},
        {'02:00': []},
        {'03:00': []},
        {'04:00': []},
        {'05:00': []},
        {'06:00': []},
        {'07:00': []},
        {'08:00': []},
        {'09:00': []},
        {'10:00': []},
        {'11:00': []},
        {'12:00': []},
        {'13:00': []},
        {'14:00': []},
        {'15:00': []},
        {'16:00': []},
        {'17:00': []},
        {'18:00': []},
        {'19:00': []},
        {'20:00': []},
        {'21:00': []},
        {'22:00': []},
        {'23:00': []},
      ];
      this.thursday = [
        {'00:00': []},
        {'01:00': []},
        {'02:00': []},
        {'03:00': []},
        {'04:00': []},
        {'05:00': []},
        {'06:00': []},
        {'07:00': []},
        {'08:00': []},
        {'09:00': []},
        {'10:00': []},
        {'11:00': []},
        {'12:00': []},
        {'13:00': []},
        {'14:00': []},
        {'15:00': []},
        {'16:00': []},
        {'17:00': []},
        {'18:00': []},
        {'19:00': []},
        {'20:00': []},
        {'21:00': []},
        {'22:00': []},
        {'23:00': []},
      ];
      this.friday = [
        {'00:00': []},
        {'01:00': []},
        {'02:00': []},
        {'03:00': []},
        {'04:00': []},
        {'05:00': []},
        {'06:00': []},
        {'07:00': []},
        {'08:00': []},
        {'09:00': []},
        {'10:00': []},
        {'11:00': []},
        {'12:00': []},
        {'13:00': []},
        {'14:00': []},
        {'15:00': []},
        {'16:00': []},
        {'17:00': []},
        {'18:00': []},
        {'19:00': []},
        {'20:00': []},
        {'21:00': []},
        {'22:00': []},
        {'23:00': []},
      ];
      this.saturday = [
        {'00:00': []},
        {'01:00': []},
        {'02:00': []},
        {'03:00': []},
        {'04:00': []},
        {'05:00': []},
        {'06:00': []},
        {'07:00': []},
        {'08:00': []},
        {'09:00': []},
        {'10:00': []},
        {'11:00': []},
        {'12:00': []},
        {'13:00': []},
        {'14:00': []},
        {'15:00': []},
        {'16:00': []},
        {'17:00': []},
        {'18:00': []},
        {'19:00': []},
        {'20:00': []},
        {'21:00': []},
        {'22:00': []},
        {'23:00': []},
      ];
      this.sunday = [
        {'00:00': []},
        {'01:00': []},
        {'02:00': []},
        {'03:00': []},
        {'04:00': []},
        {'05:00': []},
        {'06:00': []},
        {'07:00': []},
        {'08:00': []},
        {'09:00': []},
        {'10:00': []},
        {'11:00': []},
        {'12:00': []},
        {'13:00': []},
        {'14:00': []},
        {'15:00': []},
        {'16:00': []},
        {'17:00': []},
        {'18:00': []},
        {'19:00': []},
        {'20:00': []},
        {'21:00': []},
        {'22:00': []},
        {'23:00': []},
      ]
      this.days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
      this.getEmployeeTotalHours = this.getEmployeeTotalHours.bind(this);
    }

    getEmployeeTotalHours(id) {
        let count = 0;
        this.days.forEach(day => {
            this[day].forEach(hourObj => {
                if (hourObj[Object.keys(hourObj)[0]].length > 0) {
                    hourObj[Object.keys(hourObj)[0]].forEach(employee => {
                      if (employee._id === id) {
                        ++count
                      }
                    })
                }
            })
        })
        return count;
    }

    test() {console.log('test')}
}

function generateMonth(date) {
    //TODO: Add capabality for leap year
    let firstDay = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
    //Date object week starts with sunday as 0. Here reassigning first day to 7 if 0.
    if (firstDay === 0 ) { firstDay = 7 }
    const month = date.getMonth();
    //Creates an array of numbers from 0 to 
    const daysArr = Array.apply(null, {length: daysInMonth[month] + 1}).map(Number.call, Number);
    daysArr.shift();

    if ( firstDay > 1 ) {
        const previousMonth = month === 0 ? 11 : month-1;
        const previousMonthDays = daysInMonth[previousMonth];
        const previousMonthDaysArr = Array.apply(null, {length: previousMonthDays + 1}).map(Number.call, Number);
        previousMonthDaysArr.shift();
        for (let i = 1; i < firstDay; i++) {
            daysArr.unshift(previousMonthDaysArr[previousMonthDaysArr.length -i])
        }
    }
    const daysInWeek = 7;
    let totalDaysDisplayed;
    
    daysArr.length > 35 ? totalDaysDisplayed = 42 : totalDaysDisplayed = 35;

    const daysLeft = totalDaysDisplayed - daysArr.length;
    for (let i = 1; i < daysLeft + 1 ; i++) {
        daysArr.push(i);
    }

    const daysInWeeksArr = []
    for (let i = 0; i < totalDaysDisplayed; i = i + daysInWeek ) {
        daysInWeeksArr.push(daysArr.slice(i, i+daysInWeek));
    }

    return daysInWeeksArr
  }

function generateWeekID(year, month, weekArr, weekIndex) {
    let weekID = `${year}`
    if (weekIndex === 0) {
        // If monday of first week is in previous month
        if (weekArr[0] > 20) {
            let newMonth = month > 0 ? month - 1 : 11;
            weekID = `${weekID}-${newMonth}-${weekArr[0]}-${month}-${weekArr[6]}`;
            return weekID
        }
        else {
            weekID = `${weekID}-${month}-${weekArr[0]}-${month}-${weekArr[6]}`;
            return weekID;
        }
    }
    else if (weekIndex === 4 || weekIndex === 5) {
        if (weekArr[6] < 20) {
            let newMonth = month < 11 ? month + 1 : 0;
            weekID = `${weekID}-${month}-${weekArr[0]}-${newMonth}-${weekArr[6]}`;
            return weekID;
        }
        else {
            weekID = `${weekID}-${month}-${weekArr[0]}-${month}-${weekArr[6]}`;
            return weekID; 
        }
    }
    else {
        weekID = `${weekID}-${month}-${weekArr[0]}-${month}-${weekArr[6]}`;
        return weekID;
    }
}

export const timetables2018 = {};

for (let i = 0; i < 12; i++) {
    const selectedDate = new Date(2018, i);
    generateMonth(selectedDate)
        .forEach((weekArr, index) => {
            const weekID = generateWeekID(selectedDate.getFullYear(), selectedDate.getMonth(), weekArr, index);
            if (!timetables2018[weekID]) {
                timetables2018[weekID] = new Timetable
            }
        })
}

console.log(timetables2018) 